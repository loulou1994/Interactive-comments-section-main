"use strict";function asyncGeneratorStep(e,t,n,r,a,o,s){try{var c=e[o](s),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){asyncGeneratorStep(o,r,a,s,c,"next",e)}function c(e){asyncGeneratorStep(o,r,a,s,c,"throw",e)}s(void 0)}))}}var rmScore,rmElement,mainContainer=document.querySelector("main"),deleteBtns=document.querySelectorAll(".overlay button"),scoreList=[],createdAtId=0,getData=function(){var e=_asyncToGenerator((function*(){var e=yield fetch("data.json");return yield e.json()}));return function(){return e.apply(this,arguments)}}(),loadContentMarkup=function(){var e=_asyncToGenerator((function*(){var e=JSON.parse(localStorage.getItem("comments"))||(yield getData());!localStorage.getItem("comments")&&localStorage.setItem("comments",JSON.stringify(e)),e.comments.forEach((e=>{var t=e.replies,n="juliusomo"===e.user.username?loadComments(e,null,!0):loadComments(e);t&&t.forEach((e=>{"juliusomo"==e.user.username?loadComments(e,null,!0,n):loadComments(e,null,null,n)}))})),userInputBox(e.currentUser)}));return function(){return e.apply(this,arguments)}}(),postUserBox=function(){var e=_asyncToGenerator((function*(e,t){var n=yield getData();userInputBox(n=n.currentUser,e,t)}));return function(t,n){return e.apply(this,arguments)}}(),postUserComment=function(){var e=_asyncToGenerator((function*(e,t,n){var r=yield getData();r=r.currentUser,t===mainContainer?loadComments(r,e,!0):loadComments(r,e,!0,t,n)}));return function(t,n,r){return e.apply(this,arguments)}}();function loadComments(e,t,n,r,a){var o=r||mainContainer,s=document.createElement("div"),c=document.createElement("article"),l=document.createElement("div"),d=document.createElement("img"),m=document.createElement("span"),i=createDate(t?++createdAtId:e.id),u=document.createElement("p"),p=document.createElement("div"),f=document.createElement("button"),E=document.createElement("img"),v=document.createElement("span"),g=document.createElement("button"),y=document.createElement("img"),C=n?null:document.createElement("button"),S=document.createElement("img");if(s.className=r?"grid nested-inputBox":"flow",s.dataset.id=t?createdAtId:e.id,c.className="grid pd-full card",l.className="flex card__user",d.alt="alt",d.src=n&&t?e.image.webp:e.user.image.webp,m.className="fs-bold fs-300",m.textContent=n&&t?e.username:e.user.username,u.className="card__comment",u.textContent=t||e.content,p.className="card__comment-score flex blue-mod fs-bold bg-str-lt-gray ",f.dataset.score="plus",E.className="vote-button",E.alt="Upvote-button",E.src="./assets/icon-plus.svg",v.className="score",v.textContent=t?0:e.score,g.dataset.score="minus",y.className="vote-button",y.alt="downvote-button",y.src="./assets/icon-minus.svg",S.className="reply-icon",S.alt="reply-icon",S.src="./assets/icon-reply.svg",t||(createdAtId=createdAtId<e.id?e.id:createdAtId,scoreList.push(parseInt(v.textContent))),n||(C.className="card__user-btns custom-btn flex fs-bold blue-mod",C.textContent="Reply",C.addEventListener("click",(e=>{var t=e.currentTarget.parentElement,n=t.parentElement.querySelector(".card--user"),a=t.querySelector(".fs-bold").textContent,o=t.parentElement.querySelector(".separation-bar")||null;n?(t.parentElement.removeChild(n),r&&(o.style.gridRow="1 / 2")):(r&&(o.style.gridRow="1 / 3"),postUserBox(t,a))})),C.insertAdjacentElement("afterbegin",S)),r){var x=document.createElement("div"),h=document.createElement("span");x.classList.add("separation-bar"),h.classList.add("respondedUser"),h.textContent="@".concat(a||e.replyingTo," "),x.style.gridRow="1 / 2",s.appendChild(x),u.insertBefore(h,u.firstChild)}if(f.addEventListener("click",addScore),g.addEventListener("click",addScore),l.append(d,m,i),f.appendChild(E),g.appendChild(y),p.append(f,v,g),!n&&c.append(l,u,p,C),s.appendChild(c),o.appendChild(s),n){var b=document.createElement("span"),I=document.createElement("div"),L=document.createElement("button"),N=document.createElement("img"),A=document.createElement("button"),O=document.createElement("img");b.classList.add("user-reply"),I.classList.add("card__user-btns","flex"),L.classList.add("flex","custom-btn","fs-bold","red-sof"),A.classList.add("flex","custom-btn","fs-bold","blue-mod"),L.textContent="Delete",A.textContent="Edit",N.src="./assets/icon-delete.svg",O.src="./assets/icon-edit.svg",N.alt="delete-icon",O.alt="edit-icon",b.textContent="you",L.addEventListener("click",(e=>{var t=Array.from(document.querySelectorAll(".score"));document.body.querySelector(".overlay").classList.add("open"),rmScore=t.indexOf(e.currentTarget.parentElement.parentElement.querySelector(".score")),rmElement=e.currentTarget.parentElement.parentElement})),A.addEventListener("click",editCommentTask),l.insertBefore(b,l.lastChild),L.appendChild(N),A.appendChild(O),I.append(L,A),c.append(l,u,p,I)}if(t&&saveComment(s,createdAtId,a,t,e.image.webp,e.username),!r)return s}function userInputBox(e,t,n){var r=document.createElement("article"),a=document.createElement("label"),o=document.createElement("span"),s=document.createElement("img"),c=document.createElement("textarea"),l=document.createElement("button");r.className="container grid pd-full card card--user",a.for="input-user",a.className="profile-image card__label-image",o.textContent=e.username,s.src=e.image.webp,s.alt="user-photo",c.name="user-input",c.id="input-user",c.className="card__comment-input edit-text-box",c.placeholder="add comment...",l.type="submit",l.className="send-update-btn",l.textContent=n?"REPLY":"SEND",n&&r.classList.remove("container"),l.addEventListener("click",(e=>{postListener(e,n)})),a.append(o,s),r.append(a,c,l),t?t.insertAdjacentElement("afterend",r):document.body.insertBefore(r,document.body.lastElementChild)}function addScore(e){var t=Array.from(document.querySelectorAll(".score")),n=e.currentTarget.dataset.score,r=e.currentTarget.parentElement.querySelector(".score"),a=scoreList[t.indexOf(r)],o=a-1,s=0;"plus"===n?++s:"minus"===n&&--s,a+1==r.textContent&&"plus"===n?--s:o==r.textContent&&"minus"===n&&++s,r.textContent=parseInt(r.textContent)+s,saveScorContent(e.currentTarget.parentElement.parentElement,r.textContent)}function editCommentTask(e){var t=e.currentTarget.parentElement.parentElement,n=t.querySelector("p"),r=document.createElement("textarea"),a=document.createElement("button");if(n){var o=n.firstElementChild;t.classList.add("card--edit"),r.classList.add(n.className,"edit-text-box"),a.classList.add("send-update-btn"),r.rows="3",r.value=n.lastChild.nodeValue,a.textContent="UPDATE",a.addEventListener("click",(e=>{updateComment(t,r,n,o,a)})),t.replaceChild(r,n),t.appendChild(a)}}function updateComment(e,t,n,r,a){e.classList.remove("card--edit"),n.innerHTML='<span class="respondedUser">'.concat(r.textContent,"</span> ")+t.value,saveScorContent(e,t.value,!0),e.replaceChild(n,t),e.removeChild(a)}function deleteComment(){var e=rmElement.parentElement,t=this.dataset.remove;document.body.querySelector(".overlay").classList.remove("open"),"true"===t&&(saveScorContent(rmElement),e.remove(),scoreList.splice(rmScore,1))}function postListener(e,t){var n=Array.from(document.body.querySelectorAll(".score")),r=e.currentTarget.parentElement,a=r.querySelector("textarea").value,o=r.closest(".flow")||null,s=o&&o.querySelectorAll(".score"),c=r.parentElement.querySelector(".separation-bar")||null,l=o?s[s.length-1]:n[n.length-1];a&&(scoreList.splice(n.indexOf(l)+1,0,0),o?(r.parentElement.removeChild(r),c&&(c.style.gridRow="1 / 2")):o=mainContainer,postUserComment(a,o,t))}function saveComment(e,t,n,r,a,o){var s={image:{webp:a},username:o},c=JSON.parse(localStorage.getItem("comments"));e.parentElement===mainContainer?c.comments.push({id:t,content:r,score:0,user:s}):c.comments[e.parentElement.dataset.id-1].replies.push({id:t,content:r,score:0,replyingTo:n,user:s}),localStorage.setItem("comments",JSON.stringify(c))}function saveScorContent(e,t,n){var r=JSON.parse(localStorage.getItem("comments")),a=JSON.parse(localStorage.getItem("createdAt")),o=parseInt(e.parentElement.dataset.id);if(e.closest(".nested-inputBox")){var s=r.comments.find((t=>t.id==e.parentElement.parentElement.dataset.id));if(n&&t)r.comments[r.comments.indexOf(s)].replies.find((e=>e.id==o)).content=t;else if(t)r.comments[r.comments.indexOf(s)].replies.find((e=>e.id==o)).score=parseInt(t);else{var c=r.comments.find((t=>t.id==e.parentElement.parentElement.dataset.id)),l=r.comments[r.comments.indexOf(c)].replies.find((e=>e.id==o)),d=r.comments[r.comments.indexOf(c)].replies.indexOf(l);a.splice(o-1,1),r.comments[r.comments.indexOf(c)].replies.splice(d,1),r=updateIdsOnDel(o,r)}}else if(n&&t)r.comments.find((e=>e.id===o)).content=t;else if(t)r.comments.find((e=>e.id===o)).score=parseInt(t);else{var m=r.comments.find((e=>e.id==o));r.comments.splice(r.comments.indexOf(m),1),a.splice(o-1,1),r=updateIdsOnDel(o,r)}localStorage.setItem("comments",JSON.stringify(r)),localStorage.setItem("createdAt",JSON.stringify(a))}function createDate(e){var t,n,r,a=["second","minute","hour","day","week","month","year"],o=JSON.parse(localStorage.getItem("createdAt"))||[],s=o[e-1];return s?((n=Math.floor(Date.now()/1e3)-s)>59&&n<3600?(r=Math.floor(n/60),t=a[1]):n<60&&(r=n,t=a[0]),n>3599&&n<86400&&(r=Math.floor(n/3600),t=a[2]),n>86399&&(r=Math.floor(n/86400),t=a[3])):(o.push(Math.floor(Date.now()/1e3)),localStorage.setItem("createdAt",JSON.stringify(o))),r=r>1?"".concat(r," ").concat(t,"s ago"):"".concat(r," ").concat(t," ago"),s?r:"0 ".concat(a[0]," ago")}function updateIdsOnDel(e,t){var n=document.querySelectorAll("[data-id]");return t.comments.forEach((t=>{var n=t.replies||null;t.id>e&&(t.id-=1),n&&n.forEach((t=>{t.id>e&&(t.id-=1)}))})),n.forEach((t=>{t.dataset.id>e&&(t.dataset.id=parseInt(t.dataset.id)-1)})),t}deleteBtns.forEach((e=>{e.addEventListener("click",deleteComment)})),loadContentMarkup();
//# sourceMappingURL=script.js.map